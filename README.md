import { Subscribe } from "/components/Subscribe";

## Enabling Subscribers with XMTP

This tutorial will guide you on how to create a simple `Subscribe` button with consent that enables the user to subscribe to your messages or notifications.

![](animation.gif)

<div className="widget-container">
  <Subscribe
    senderAddress="0x93E2fc3e99dFb1238eB9e0eF2580EFC5809C7204"
    onSubscribe={(address) => {
      console.log("New subscriber: ", address);
    }}
    onUnsubscribe={(address) => {
      console.log("Unsubscriber: ", address);
    }}
    onError={(error) => console.log("Error subscribing: " + error)}
    env="production"
  />
</div>
<div id="subscribeArray" style={{ textAlign: "center", fontSize: "12px" }}></div>

#### Import libraries

Import the necessary XMTP and Ethereum packages. These libraries enable you to create an XMTP client and interact with the Ethereum blockchain.

```jsx
import React, { useEffect, useState } from "react";
import { Client } from "@xmtp/xmtp-js";
import { ethers } from "ethers";
```

The receiver of the subscription (you), in this case is gong to be a random wallet generated by `ethers`, but you could send your own wallet as prop. This wallet is later going to

#### Subscribe with your Wallet

Your `connectWallet` function facilitates the connection to the user's Ethereum wallet.

```jsx
let wallet = await connectWallet();
let client = await Client.create(wallet, { env: env });
```

##### Consent State Management

This section delves into a crucial part of the subscription widget â€” managing the consent state of a subscriber. We'll explore how to get the subscriber's address, refresh the consent list, get the current consent state, and then update it based on user actions.

#### Refresh the Consent List

To ensure we're working with the most up-to-date information, we refresh the consent list.

```jsx
// Refresh content list
await client.contacts.refreshConsentList();
```

#### Retrieve the Current Consent State

After refreshing, we get the current consent state of the subscriber. Can be (`allowed`, `blocked`, or `unknown`)

```jsx
// Get the consent state of the subscriber
let state = client.contacts.consentState(client.address);
```

#### Update the Consent State

Based on the current state, we either allow or block the subscriber.

```jsx
// If the state is unknown or blocked, allow the subscriber
if (state == "unknown" || state == "denied") {
  await client.contacts.allow([client.address]);
}
```

- If the state is `unknown` or `blocked`, we change it to `allowed` using `client.contacts.allow([address])` and we call the `onSubscribe` function if it exists.
- If the state is `allowed`, we don't change the consent and we call the `onUnsubscribe` function if it exists.

**Callbacks**

The `onSubscribe` and `onUnsubscribe` functions are called when the consent state is updated. You can use these functions to update your local state or to send a message to your subscribers.

```jsx
<Subscribe
  onSubscribe={(address) => {
    //Update local db
    //or send a message to the subscriber
  }}
  onUnsubscribe={(address) => {
    //Update local db
    //or send a message to the subscriber
  }}
/>
```
